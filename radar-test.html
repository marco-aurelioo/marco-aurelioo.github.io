<html >
<head>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="js/bootstrap.min.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-161848228-1"></script>


    <script type="text/javascript" src="js/lib/visjs/vis.js"></script>
    <link rel="stylesheet" href="js/lib/visjs/vis-network.min.css">
    <style type="text/css">
    #mynetwork {
      width: 600px;
      height: 400px;
      border: 1px solid lightgray;
    }
    </style>

    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-161848228-1');

        jQuery.support.cors = true;
       
        function getURLData(url_git){
            var resposta = JSON.parse(localStorage.getItem(url_git));
            if(!resposta){
                $.ajax({
                    url: url_git,
                    type: "GET",
                    timeout: 30000,
                    async: false,
                    dataType: "json", 
                    success: function(data) {
                        resposta = data;
                        localStorage.setItem(url_git,JSON.stringify(data));
                    },
                    error: function(jqXHR, textStatus, ex) {
                        return {};
                    }
                });
            }
            return resposta;
        }    

        function clearLocalStore(){
            localStorage.clear();
        }

        var tec_languages = [];
        
        function getProfileGit(userName){            
            let url_site = "https://api.github.com/search/repositories?q=user:"+userName+"&sort=stars&order=desc"
            var data = getURLData(url_site);
            tec_languages = [];
            data.items.
                forEach(getLanguages);            
            var totais = new Map();
            for(var i in tec_languages){
                var key = i;
                var val = tec_languages[i];
                for(var j in val){
                    var sub_key = j;
                    var sub_val = val[j];
                    var sub_val_hist = totais.get(sub_key);
                    if(sub_val_hist){
                        totais.set(sub_key,Number(sub_val_hist)+Number(sub_val));
                    }else{
                        totais.set(sub_key,sub_val);
                    }
                }
            }           
            console.log(totais);
        }

        function getLanguages(item,idx){
            var languages = getURLData(item.languages_url);
            const map = new Map(Object.entries(languages));
            tec_languages.push(languages);
        }

        function findProfile(){
            var profile = document.getElementById ("usuario").value;
            console.log(profile);
            addProfile(profile);
        }

        function addProfile(userName){
            if(document.getElementById("id_"+userName)){
                console.log("ja existe");
                return;
            }
          
            var url_profile =" https://api.github.com/users/"+userName;
            var data = getURLData(url_profile);
            console.log(data);
            if(data.login){
               
                var newProfile = document.createElement("div");
                newProfile.setAttribute("id","id_"+userName);
                
                newProfile.classList.add("itemBusca");

                var nameElement = document.createElement("h3");
                nameElement.innerHTML = data.login;

                var avatarElement = document.createElement("img");
                avatarElement.src = data.avatar_url;
                avatarElement.classList.add("imageside");
                avatarElement.width = 100;
                avatarElement.height = 100; 
                
                var bntCarregaGit = document.createElement("button");
                bntCarregaGit.innerHTML = "incluir"
                bntCarregaGit.onclick = function(){
                    addToGraph(data.login);
                }

                var bntRemoveGit = document.createElement("button");
                bntRemoveGit.innerHTML = "apagar"
                bntRemoveGit.onclick = function(){
                    var elementToRemove = document.getElementById("id_"+userName);
                    document.getElementById("profiles").removeChild(elementToRemove);
                }

                newProfile.appendChild(nameElement);
                newProfile.appendChild(avatarElement);
                newProfile.appendChild(bntCarregaGit);
                newProfile.appendChild(bntRemoveGit);
                document.getElementById("profiles").appendChild(newProfile);
            }
        }

        function addToGraph(userName){


        }





  // create an array with nodes
  var nodes = new vis.DataSet([
    {id: 1, shape: 'circularImage', label: "marco-aurelioo", circularImage:"https://avatars0.githubusercontent.com/u/5507398?v=4"},
    {id: 2, label: 'Node 2'},
    {id: 3, label: 'Node 3'},
    {id: 4, label: 'Node 4'},
    {id: 5, label: 'Node 5'}
  ]);

  // create an array with edges
  var edges = new vis.DataSet([
    {from: 1, to: 3},
    {from: 1, to: 2},
    {from: 2, to: 4},
    {from: 2, to: 5},
    {from: 3, to: 3}
  ]);

  function createCanvas(){
    // create a network
    var container = document.getElementById('mynetwork');

    var data = {
        nodes: nodes,
        edges: edges
    };
    var options = {
        nodes: {
            image: "https://avatars0.githubusercontent.com/u/5507398?v=4"
        }

    };
    var network = new vis.Network(container, data, options);
  }
  

    </script>
    <style >
        @media (max-width: 700px) {
            .mediaimg{display: none;}
            .btn-toggle{display: block;}
        }

        #mynetwork {
            width: 600px;
            height: 400px;
            border: 1px solid lightgray;
        }

        .imageside
        { 
            -webkit-border-top-left-radius: 150px; 
            -webkit-border-top-right-radius: 150px; 
            -webkit-border-bottom-right-radius: 150px; 
            -webkit-border-bottom-left-radius: 150px; 
            -moz-border-radius-topleft: 150px; 
            -moz-border-radius-topright: 150px; 
            -moz-border-radius-bottomright: 150px; 
            -moz-border-radius-bottomleft: 150px; 
            border-top-left-radius: 150px; 
            border-top-right-radius: 150px;
            border-bottom-right-radius: 150px;
            border-bottom-left-radius: 150px; 
        }

        .colbusca {
            background-color: #62806B;
            border:#3C8051 1px dotted;
            color:#C4FFD7;
            -webkit-border-top-left-radius: 15px; 
            -webkit-border-top-right-radius: 15px; 
            -webkit-border-bottom-right-radius: 15px; 
            -webkit-border-bottom-left-radius: 15px; 
            -moz-border-radius-topleft: 15px; 
            -moz-border-radius-topright: 15px; 
            -moz-border-radius-bottomright: 15px; 
            -moz-border-radius-bottomleft: 15px; 
            border-top-left-radius: 15px; 
            border-top-right-radius: 15px;
            border-bottom-right-radius: 15px;
            border-bottom-left-radius: 15px; 
            padding:20px;  
            -ms-flex: 0 0 400px;
            flex: 0 0 400px;
        }
        .itemBusca{
            background-color: #C4FFD7;
            border:#78FFA3 1px dotted;
            color: #62806B;
            -webkit-border-top-left-radius: 15px; 
            -webkit-border-top-right-radius: 15px; 
            -webkit-border-bottom-right-radius: 15px; 
            -webkit-border-bottom-left-radius: 15px; 
            -moz-border-radius-topleft: 15px; 
            -moz-border-radius-topright: 15px; 
            -moz-border-radius-bottomright: 15px; 
            -moz-border-radius-bottomleft: 15px; 
            border-top-left-radius: 15px; 
            border-top-right-radius: 15px;
            border-bottom-right-radius: 15px;
            border-bottom-left-radius: 15px; 
            padding:20px;  
            margin: 20px; 
            width: 400px;
        }

    </style>
</head>
<body>

<header>
    <!-- Fixed navbar -->
    <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
        <a class="navbar-brand" href="#">Portifolio de projetos e estudo.</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
            <a class="nav-link" href="#">Home <span class="sr-only">(atual)</span></a>
            </li>
            <li class="nav-item">
            <a class="nav-link" href="./tec-radar.html">Tec Radar</a>
            </li>
            <li class="nav-item">
            <a class="nav-link disabled" href="#">Projetos e estudo</a>
            </li>
        </ul>
        </div>
    </nav>
</header>
<div class="jumbotron text-center">
<h1>Pagina portifolio</h1>
<p>Este site destina-se a listar testes e tambem como repositorio de informações que acho relevante para ser apresentada.</p>
</div>

<div class="container">
    <div class="row" >
    <div class="colbusca" >
        <div> 
        <h4>Ver ligações</h4>
        </div>
        <div class="input-group mb">
            <div class="input-group-prepend">
                <span class="input-group-text" id="basic-addon2">https://github.com/</span>
            </div>
            <input type="text" class="form-control" id="usuario" aria-describedby="basic-addon3">
            <div class="input-group-append">
                <input type="image" alt="buscar" src="img/lupa.jpg" onclick="findProfile()" width="38" height="38"/>
            </div>
        </div>
        
        
        <hr/>
        <div class="row" id="profiles">
            
        </div>
        
    </div>
    <div class="col-sm-6">
        <div class="row" >
        <button onclick="createCanvas()" >cria grafo</button>
        
        <div id="mynetwork"></div>
    </div>
    </div>
</div>
    
</div>
<footer class="footer">
    <div class="container">
      <span class="text-muted">contato: marco_aurelioo@yahoo.com.br </span>
    </div>
</footer>
</body>
</html>